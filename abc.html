<!DOCTYPE html> 
<html>
	<head>
        <meta charset="utf-8">
        <title>Map cpa</title>
       <script src="js/jquery-1.6.4.min.js" type="text/javascript"></script>
        <link rel="stylesheet"  href="css/panel/jquery.mobile-1.3.0-beta.1.css">
		<link rel="stylesheet" href="css/panel/jqm-demos.css">
		<script src="js/panel/jquery-1.7.1.min.js"></script>
		<script src="js/panel/jquery.mobile-1.3.0-beta.1.js"></script>
        <link href="css/myStyle.css" rel="stylesheet" type="text/css"/>
        <script src="js/jquery.constant.js"></script>
       <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
         <style>
      html, body, #map {
        width:100%;
		height: inherit;
        margin: 0px;
        padding: 0px
      }
    </style>
        <script>
		
		var map;
			var locations = [];
			var ResultCollection = '';
			var obj = [];
			
            function init(){
                onAppResize();
				//initialize();
				onMapLoad();
				if(sessionStorage.login_id == null){
				
				document.getElementById('save_search').style.visibility= 'visible';
				
				
				
				}else{
					
					var guest =  document.getElementById('save_search');
				
					document.getElementById('some').removeChild(guest);
					
					
					document.getElementById('save_search2').style.visibility= 'visible';
				}
				
				
            }
            function onAppResize(){
                var headerH = $('#headerDiv').height();
                if(headerH == 0){
                    headerH = 50;
                }
				
                var appHeight = window.innerHeight;
                var contentH = appHeight-(headerH)-5;
				$('#contentDiv').height(contentH);
				$('#mapIframe').height(contentH);
				
            }
			
			function onSlideOPENClick(){
				$('#slidePopUp').show();
				$('#slidePopUp').animate({
					height:(window.innerHeight+"px"),
				},500,function(){});
					
				//$('#slidePopUp').css('height',);
			}
			
			function onPopUpCloseClick(){
				$('#slidePopUp').show();
				$('#slidePopUp').animate({
					height:(0+"px"),
				},500,function(){
					$('#slidePopUp').hide();
				});
			}
			
			
			
			function onSaveSearch(){
			
			var save_input = $('#pop-input').val();
			
			var addinquiry = {
									"search_key"		:	 sessionStorage.postcode,//area,postcode
									"search_name"       : 	 save_input,
									"login_id"          :   sessionStorage.login_id,
									"search_type"		:	"Property"//Tenants / Property
                                                        
							}
						
					var param1= 'search_save='+JSON.stringify(addinquiry);
					getStatus=getDataFromWebservices(search_saveurl,param1);
			
						var status =getStatus.status;
						//var reg_id = getStatus.Result;
						console.log(status);
						//console.log(Registration_id);
						
						
					if(status=="YES")
					{
						ResultCollection = getStatus.Result;
						//alert(save_input);	
							
							
					}
			
			
			
			}
			
			
	

/*var geocoder;
var map;
var query;
var address;

function initialize() {
 geocoder = new google.maps.Geocoder();
  var mapOptions = {
    zoom: 8
  }
  map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
 
 // address = $('#postcode').val();
 address =sessionStorage.postcode;
	//alert(address);
	
	
	codeAddress() ;
 
}

function codeAddress() {
	
	geocoder.geocode( { 'address': address}, function(results, status) {
    if (status == google.maps.GeocoderStatus.OK) {
      map.setCenter(results[0].geometry.location);
      var marker = new google.maps.Marker({
          map: map,
          position: results[0].geometry.location
      });
    } else {
      alert('Geocode was not successful for the following reason: ' + status);
    }
  });
  
	 
}	
	*/		
	
		
		
		
		
		
		function onMapLoad(){
		
		var addinquiry = {
                               "Login_id" : sessionStorage.login_id,
                                                     
                                                        
						}
						
						
				var param1= 'GetMap='+JSON.stringify(addinquiry);
				getDetails=getDataFromWebservices(getmapurl,param1);
				//getDetails=getDataFromWebservices(loginurl,param1);
				var status =getDetails.status;
				console.log(status);
				
				if(status=="YES")
						{
							ResultCollection = getDetails.Result;
					
					
							//var newItem;
							for(var i=0; i<ResultCollection.length; i++){
								var LoginData =  ResultCollection[i];
								
								var id = LoginData.id;
								var lat = LoginData.latitude;
								var lang = LoginData.longitude;
								
								console.log("id ===>"+id);
								console.log("lat ===>"+lat);
								console.log("lang ===>"+lang);
								
								
		var obj = ['DESCRIPTION',ResultCollection[i].latitude,ResultCollection[i].longitude,'1'];		
							
							locations.push(obj);
							
							}
							
							console.log("locations ===>"+locations);
							initialize();
				}else{
					var iframe = document.createElement("IFRAME");
  iframe.setAttribute("src", 'data:text/plain,');
  document.documentElement.appendChild(iframe);
  var person = window.frames[0].window.alert("wrong !");
  iframe.parentNode.removeChild(iframe);

					
					}} 
				
				
function initialize() {
							
								
	 window.map = new google.maps.Map(document.getElementById('map'), {
        mapTypeId: google.maps.MapTypeId.ROADMAP
    });

    var infowindow = new google.maps.InfoWindow();

    var bounds = new google.maps.LatLngBounds();

    for (i = 0; i < locations.length; i++) {
        marker = new google.maps.Marker({
            position: new google.maps.LatLng(locations[i][1], locations[i][2]),
            map: map
        });

        bounds.extend(marker.position);

        google.maps.event.addListener(marker, 'click', (function (marker, i) {
            return function () {
                infowindow.setContent(locations[i][0]);
                infowindow.open(map, marker);
            }
        })(marker, i));
    }

    map.fitBounds(bounds);

    var listener = google.maps.event.addListener(map, "idle", function () {
        map.setZoom(11);
        google.maps.event.removeListener(listener);
    });

					
					
					
					
					
					}
					
			
        </script>
        
        
        
        
	</head> 
    
    <body onResize="onAppResize()" onLoad="init()"> 
    	<div data-role="page" id="page" style="height:auto;" class="myContentBG">
         
        
            <!--Header Start-->
            <div id="headerDiv" data-role="header" class="myHeaderBG">
                <a href="#" onClick="document.location.href='quick_panel_out.html';" class="backBtn">Back</a>
                <h1 class="headerTitle">Map Results</h1>
                <a href="#" onClick="onSlideOPENClick()" class="lightblueBtn">Options</a>
            </div>
            <!--Header End-->
            
            <!--Content Start-->
            <div data-role="content"  id="contentDiv" style="margin:0px;padding:0px;">
            <div id="map"></div>
	            <!--<iframe id="mapIframe" width="100%" height="310" style="margin-left:0px;margin-top:0px;" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" src="https://maps.google.co.in/maps?oe=utf-8&amp;gl=in&amp;t=m&amp;ll=51.5072,0.1275&amp;spn=51.5072,0.1275&amp;z=14&amp;iwloc=A&amp;output=embed"></iframe>-->	
            </div>
            <!--Content End-->
            
            <div id="slidePopUp" hidden="true" 
            style="width:100%;position:fixed;top:0px;z-index:100; height:auto;">
            	<!--<button id="popUpCloseBtn" onClick="onPopUpCloseClick()">Close</button>-->
                <!--Header Start-->
        <div id="headerDiv" data-role="header" class="myHeaderBG">
 
                <a href="#" onClick="document.location.href='quick_panel_out.html';" class="backBtn" style="visibility:hidden;">Back</a>
                <h1 class="headerTitle">Search Options</h1>
                <a href="#" id="popUpCloseBtn" onClick="onPopUpCloseClick()" class="lightblueBtn">Hide</a>
            </div>
        <!--Header End-->
                
                <div style="background-image:url(images/bg_trans.png);">
                	<div class="all-map-images" id="some"><br /><br />
                        <img src="images/other/map-view.png" width="100%" height="auto" alt="" onClick="document.location.href='map_cpa.html';"/><br /><br />
                        <img src="images/other/photos.png" width="100%" height="auto" alt="" 
onClick="document.location.href='quick_panel_out.html';"/><br /><br />
                        <img src="images/other/list.png" width="100%" height="auto" alt=""     onClick="document.location.href='search_results.html';" /><br /><br />
                        <img src="images/other/filter.png" width="100%" height="auto" alt=""   onClick="document.location.href='search_filters_on.html';"/><br /><br />
                        
                        
                    <img id="save_search" src="images/other/save-search.png" width="100%" height="auto" alt="" onClick=		"document.location.href= 'login_screen.html';" style="visibility:hidden;"/>
                        
          <a href="#popupBasic" data-rel="popup">             
             <img id="save_search2" src="images/other/save-search.png" width="100%" height="auto" alt="" 
             style="visibility:hidden;"/></a>     
                        
                        
                        
                        
                        
                       
                    </div>
                </div>         
                
                      
            </div>
           
           
            <div data-role="popup" id="popupBasic" 
             style="background:#101c31;padding:10px;height:143px;width:92%;">
			<div id="popheader" data-role="header" 
            style="background:#101c31; height:48px">
             <a href="#" class="blueBtn" onClick="document.location.href='#';">Cancel</a>
            <h1 class="headerTitle"></h1>
            <a href="#popupBasic" onClick="onSaveSearch();" class="lightblueBtn">Save</a>
        </div>
        
        <div style="background:#dee1e6;padding:10px;height:65px;border-radius:5px;">
        <strong>&nbsp; Name your search</strong>
        	<input id="pop-input"/>
			</div>
            
            </div>
            
            
            
            
            
        
            
            
     </div>       
    </body>
</html>
